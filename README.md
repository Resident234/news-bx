Как проверять
================

[Новости находятся здесь](https://trainee6.xn----gtbdfujo3d.xn--p1ai/bitrix/admin/iblock_list_admin.php?IBLOCK_ID=1&type=news&lang=ru&find_section_section=-1)

Свойство обработанности
![img.png](img.png)

[Таблица, в которой хранятся активные на данный момент задачи по обработке](https://trainee6.xn----gtbdfujo3d.xn--p1ai/bitrix/admin/perfmon_table.php?lang=ru&table_name=bx_news_processing)

[Агент ```\BX\News\Agents\NewsCheckProcessingStatus::execute()``` крутится раз в минуту](https://trainee6.xn----gtbdfujo3d.xn--p1ai/bitrix/admin/agent_list.php?PAGEN_1=1&SIZEN_1=20&lang=ru&set_filter=Y&adm_filter_applied=0&find=bx.news&find_type=module_id) 

Все завернуто в модуль ```bx.news```, он уже установлен 
                                                  
Процесс работы: 
------------

1) Новость создается или редактируется
2) Отправляется запрос create-work в сервис
3) В таблицу bx_news_processing добавляется запись 
4) Поле "Обработано" новости становится неустановленным
5) Агент считывает таблицу
6) Для каждой записи делается запрос check-work в сервис
7) Если обработка в сервисе завершена, то 
8) ставится чебокс "Обработано" у новости
9) удаляется запись из таблицы

Предусмотренные крайние ситуации:
------------

1) Если редактируем новость несколько раз подряд. А за это время таск на сервисе выполниться не успеет. Сервис вернет id последнего реквеста, мы его обновляем в записи в таблице, соответствующей данной новости (несколько записей в таблице для одной и той же новости создано быть не может). И работаем мы, соответственно, с последним из запустившихся тасков. 

2) Если удаляем новость. Из таблицы удаляется запись, соответвующая этой новости, если таковая есть. И с данного момента проверка статуса таска для этой удаленной новости производиться не будет. 